<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ocean Coffee - Brasil</title>
  <link rel="icon" href="IMG/Loginho2.png" type="image/png">
  <link rel="stylesheet" href="CSS/styles.css" />
  <link rel="stylesheet" href="CSS/anuncie.css">
  <link rel="stylesheet" href="CSS/popup-anuncie.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="https://use.typekit.net/hta6hdp.css">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.0.23/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
</head>

<body>
  <!-- NAVBAR -->
  <header class="navbar">
    <div class="navbar-left">
      <span class="currency">U$</span>
      <i class="fas fa-arrow-up up-icon"></i>
      <a href="MarketPlace.html"><i class="fas fa-store"></i></a>
    </div>
    <nav class="navbar-center">
      <a href="Index.html">Nosso Café</a>
      <a href="Index.html">Serviços</a>
      <a href="Index.html">Sobre</a>
      <a href="Login.html">Login</a>
    </nav>
    <div class="navbar-right">
      <i class="fas fa-sun"></i>
      <span class="temp">30°C</span>
      <i class="fas fa-chevron-down"></i>
    </div>
  </header>

  <!-- FORMULÁRIO DE ANÚNCIO -->

  <section>
    <div class="containe">
      <div class="imagem-section space-y-4">

        <!-- Imagem 1 -->
        <div class="container_file">
          <label class="block text-gray-700 font-semibold mb-1" for="imagem1">Imagem 1:</label>
          <input type="file" id="imagem1" accept="image/*"
            class="block w-full text-sm text-gray-700 bg-white border border-gray-300 rounded-lg cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700 transition duration-150">
        </div> <br>

        <!-- Imagem 2 -->
        <div class="container_file">
          <label class="block text-gray-700 font-semibold mb-1" for="imagem2">Imagem 2:</label>
          <input type="file" id="imagem2" accept="image/*"
            class="block w-full text-sm text-gray-700 bg-white border border-gray-300 rounded-lg cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700 transition duration-150">
        </div> <br>

        <!-- Imagem 3 -->
        <div class="container_file">
          <label class="block text-gray-700 font-semibold mb-1" for="imagem3">Imagem 3:</label>
          <input type="file" id="imagem3" accept="image/*"
            class="block w-full text-sm text-gray-700 bg-white border border-gray-300 rounded-lg cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700 transition duration-150">
        </div>

        <!-- Botão -->
        <div class="button-container2 pt-2">
          <button id="publicarBtn" class="publicar-btn">
            <img src="IMG/Loginho.png" alt="Publicar" class="icon2">
            Publicar
          </button>
        </div>
      </div>

      <!-- Campos do formulário -->
      <div class="form-section">
        <input type="text" id="produto" placeholder="Produto">
        <input type="text" id="localizacao" placeholder="Localização">
        <input type="text" id="preco" placeholder="Preço">
        <input type="text" id="descricao" placeholder="Descrição">
        <input type="text" id="contato" placeholder="Contato">
      </div>
    </div>
  </section>




  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-left">
        <img src="IMG/Logo.png" alt="Logo Ocean Coffee" class="footer-logo">
        <p class="nwe">&copy; 2025 Ocean Coffee. <br>Todos os direitos reservados.</p>
      </div>
      <div class="footer-links">
        <h1 class="txt">Links Rápidos</h1>
        <a href="#NossoCafe">Nosso Café</a>
        <a href="#Serviços">Serviços</a>
        <a href="#Sobre">Sobre</a>
        <a href="#NossoEstabelecimento">Estabelecimento</a>
        <a href="#Colaboradores">Colaboradores</a>
      </div>
      <div class="Empresa">
        <h1 class="txt1">Sobre a Ocean Coffee</h1>
        <p class="txt2">A Ocean Coffee foi fundada em 01 <br> de outubro de 2019, com a missão de <br> revolucionar
          o mercado <br>cafeeiro ao unir tradição e inovação.
        </p>
      </div>
      <div class="footer-social">
        <a href="#"><i class="fab fa-facebook-f"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
        <a href="#"><i class="fab fa-whatsapp"></i></a>
      </div>
    </div>
  </footer>

  <!-- JS -->
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    const supabaseUrl = "https://uldxazlnnpuoxfzsovmu.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVsZHhhemxubnB1b3hmenNvdm11Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg3Mjg2NzgsImV4cCI6MjA2NDMwNDY3OH0.fyToys8_muc1XyUebJ19gxGEkCVM_cXg80UJR894xQY";
    const supabase = createClient(supabaseUrl, supabaseKey);

    document.getElementById('publicarBtn').addEventListener('click', async (e) => {
      e.preventDefault();

      const { data: sessao } = await supabase.auth.getSession();
      const user = sessao?.session?.user;

      if (!user) {
        alert("Você precisa estar logado para publicar.");
        return;
      }

      const produto = document.getElementById("produto").value.trim();
      const local = document.getElementById("localizacao").value.trim();
      const preco = document.getElementById("preco").value.trim();
      const descricao = document.getElementById("descricao").value.trim();
      const contato = document.getElementById("contato").value.trim();

      const files = [
        document.getElementById('imagem1').files[0],
        document.getElementById('imagem2').files[0],
        document.getElementById('imagem3').files[0]
      ].filter(Boolean);

      if (files.length === 0) {
        alert("Por favor, selecione pelo menos uma imagem.");
        return;
      }

      const imagens = [];

      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const path = `usuarios/${user.id}/produtos/${Date.now()}_${i}_${file.name}`;

        const { error: uploadError } = await supabase.storage.from('imagens').upload(path, file);
        if (uploadError) {
          alert(`Erro ao enviar a imagem ${i + 1}: ` + uploadError.message);
          return;
        }

        const { data: urlData } = supabase.storage.from('imagens').getPublicUrl(path);
        imagens.push(urlData.publicUrl);
      }

      const { error: insertError } = await supabase
        .from("produtos")
        .insert({
          user_id: user.id,
          produto,
          local,
          preco,
          descricao,
          contato,
          imagens,
          data: new Date().toISOString()
        });

      if (insertError) {
        alert("Erro ao salvar dados: " + insertError.message);
      } else {
        // Exibe o popup de sucesso
        // Exibe o popup de sucesso com animação de check
        const popup = document.createElement("div");
        popup.classList.add("popup-cadastro");
        popup.innerHTML = `
  <div class="checkmark-container">
    <svg class="checkmark" viewBox="0 0 52 52">
      <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none" />
      <path class="checkmark-check" fill="none" d="M14 27l7 7 16-16"/>
    </svg>
  </div>
  <strong>Anúncio enviado para análise com sucesso!</strong>
`;
        document.body.appendChild(popup);

        setTimeout(() => {
          popup.style.animation = "fadeOut 0.6s ease forwards";
          popup.addEventListener("animationend", () => {
            popup.remove();
            window.location.replace("Confirmacao.html");
          });
        }, 3000);

      }
    });
  </script>


</body>

</html>