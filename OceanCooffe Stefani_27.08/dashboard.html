<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Dashboard - Administrador Ocean Coffee</title>
    <link class="novo" rel="icon" href="IMG/Loginho2.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* CSS COMPLETO E UNIFICADO (Baseado em admin.html/Solicitações.html) */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; height: 100vh; background-color: #f4f7f6; overflow: hidden; }

        /* --- SIDEBAR CONSISTENTE --- */
        .sidebar {
            width: 250px;
            display: flex;
            flex-direction: column;
      justify-content: space-between;
            background-color: #5ce1e6; /* Cor ciano original */
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            position: fixed; /* Mantido fixo */
            height: 100%;
            left: 0;
            top: 0;
            z-index: 1001;
            transition: width 0.3s ease, left 0.3s ease; /* Transição para width e left */
        }
        .sidebar.collapsed {
            width: 70px;
        }

        .logo {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            height: 139px; /* Altura consistente com header */
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: padding 0.3s ease, border-color 0.3s ease; /* Transição adicionada */
        }
         /* Comportamento do logo ao colapsar - IGUAL AO ADMIN.HTML */
         .sidebar.collapsed .logo {
             padding: 10px 0; /* Padding menor */
             border-bottom-color: transparent; /* Remove borda */
         }
        .logo img {
            max-width: 150px;
            height: auto;
            display: block;
            transition: opacity 0.2s ease, width 0.3s ease; /* Transição original */
        }
         .sidebar.collapsed .logo img {
            opacity: 0;
            width: 0; /* Esconde a imagem */
            pointer-events: none;
         }

        .menu { display: flex; flex-direction: column; gap: 5px; padding: 20px 0; flex-grow: 1; overflow-y: auto; }
        /* Estilo dos itens de menu IGUAL AO ADMIN.HTML */
        .menu-item, .menu-item-logout {
            display: flex; align-items: center; gap: 12px;
            padding: 12px 25px; /* Padding original */
            border-radius: 0 25px 25px 0; /* Raio original */
            color: #333; font-weight: 600; cursor: pointer;
            transition: background 0.3s ease, color 0.3s ease, transform 0.2s ease, padding 0.3s ease; /* Transições originais */
            text-decoration: none; white-space: nowrap; overflow: hidden;
            margin-right: 0; /* Removido margin-right extra */
         }
        .menu-item span, .menu-item-logout span { transition: opacity 0.3s ease; opacity: 1; }
        .sidebar.collapsed .menu-item, .sidebar.collapsed .menu-item-logout {
            justify-content: center; padding: 12px 0; /* Padding colapsado original */
            margin-right: 0;
         }
        .sidebar.collapsed .menu-item span, .sidebar.collapsed .menu-item-logout span { opacity: 0; width: 0; }
        .menu-item i, .menu-item-logout i { /* Ícones com estilo consistente */
             width: 22px; height: 22px; color: #333;
             transition: color 0.3s ease; flex-shrink: 0;
             text-align: center; font-size: 1.2rem;
         }
         /* SVG Logout icon - mantido se você usou SVG no admin.html, senão use <i> */
         .menu-item-logout svg { width: 22px; height: 22px; fill: #333; transition: fill 0.3s ease; flex-shrink: 0; }

        .menu-item:hover, .menu-item-logout:hover { background-color: rgba(255, 255, 255, 0.2); color: #1a1a1a; }
        .sidebar.collapsed .menu-item:hover, .sidebar.collapsed .menu-item-logout:hover { transform: none; }
        .menu-item.selected { background: linear-gradient(to right, #0047a3, #3ac0dd); color: white; box-shadow: 3px 0 8px rgba(0, 0, 0, 0.2); }
        .menu-item.selected i { color: white; }
        .menu-item.selected svg { fill: white; } /* Para o ícone SVG de logout */
        .menu-item-logout { margin-top: auto; }

        /* Botão inferior para colapsar - IGUAL AO ADMIN.HTML */
        .sidebar-bottom {
            background-color: #0cc0df; text-align: center; padding: 15px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.2); cursor: pointer;
            transition: background 0.3s ease; flex-shrink: 0;
         }
        .sidebar-bottom:hover { background-color: #08a3bd; }
        /* Usando SVG para o ícone, como no admin.html */
        .sidebar-bottom svg { width: 28px; height: 28px; fill: #333; }
         /* Rotação do ícone SVG ao colapsar (se for o mesmo SVG do admin.html) */
         /* .sidebar.collapsed .sidebar-bottom svg { transform: rotate(180deg); } /* Ajuste se necessário */


        /* --- CONTEÚDO PRINCIPAL CONSISTENTE --- */
        .content {
            flex: 1;
            margin-left: 250px;
            transition: margin-left 0.3s ease;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Evita scroll duplo */
        }
        .content.shifted {
            margin-left: 70px;
        }

        /* --- HEADER CONSISTENTE --- */
        .header {
            width: calc(100% - 250px);
            height: 60px; /* Altura do header consistente */
            background: linear-gradient(to right, #0047a3, #3ac0dd); /* Gradiente original */
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between; /* Para hamburger e título */
            padding: 0 1.5rem; /* Padding ajustado */
            position: fixed;
            top: 0;
            left: 250px;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: left 0.3s ease, width 0.3s ease;
            flex-shrink: 0;
        }
        .header.shifted {
            left: 70px;
            width: calc(100% - 70px);
        }
        .header-title { /* Título "Dashboard" */
            font-size: 22px; /* Tamanho original */
            font-weight: bold;
            position: absolute; left: 50%; transform: translateX(-50%); /* Centralizado */
             white-space: nowrap;
        }

        /* Botão Hamburger (mostrado apenas no mobile) */
        .menu-toggle-mobile {
             display: none;
             background: none; border: none; color: white;
             font-size: 1.8rem; cursor: pointer; padding: 0.5rem;
             z-index: 1001; /* Garante que fique clicável */
        }

        .main-content { /* Conteúdo rolável */
            flex-grow: 1;
            overflow-y: auto;
            padding: 1.5rem;
            margin-top: 60px; /* Espaço para o header fixo de 60px */
            background-color: #f4f7f6; /* Cor de fundo original */
        }

        /* --- ESTILOS DO DASHBOARD (Cards, Gráfico, Lista - Sem alterações visuais) --- */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card-link { text-decoration: none; color: inherit; }
        .stat-card { background-color: #ffffff; padding: 1.5rem; border-radius: 12px; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.07); display: flex; align-items: center; gap: 1.5rem; transition: transform 0.2s ease, box-shadow 0.2s ease; cursor: pointer; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 12px 25px rgba(0, 0, 0, 0.1); }
        .stat-card .icon-container { font-size: 2rem; padding: 1rem; border-radius: 50%; display: flex; align-items: center; justify-content: center; width: 60px; height: 60px;} /* Tamanho original ícone */
        .stat-card .icon-container.users { background-color: #e0f7fa; color: #00796b; }
        .stat-card .icon-container.pending { background-color: #fff3e0; color: #f57c00; }
        .stat-card .icon-container.approved { background-color: #e8f5e9; color: #388e3c; }
        .stat-card .info h3 { font-size: 1rem; color: #6c757d; margin: 0 0 0.5rem 0; }
        .stat-card .info p { font-size: 2rem; font-weight: 700; color: #333; margin: 0; }

        .dashboard-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
        .chart-container, .recent-requests { background-color: #fff; padding: 1.5rem; border-radius: 12px; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.07); }
        .chart-container h2, .recent-requests h2 { font-size: 1.25rem; margin-top: 0; padding-bottom: 1rem; border-bottom: 1px solid #eee; }
        #pieChartContainer { max-height: 350px; display: flex; justify-content: center; align-items: center; margin-top: 1rem; }
        #statusPieChart { cursor: pointer; }
        .requests-list { list-style: none; padding: 0; margin-top: 1rem; }
        .requests-list li { display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid #f0f0f0; }
        .requests-list li:last-child { border-bottom: none; }
        .requests-list .product-info { display: flex; flex-direction: column; }
        .requests-list .product-name { font-weight: 600; color: #333; font-size: 0.95rem;}
        .requests-list .user-name { color: #6c757d; font-size: 0.9rem; }
        .requests-list .view-link { color: #fff; background-color: #007bff; padding: 6px 12px; border-radius: 6px; text-decoration: none; font-size: 0.9rem; transition: background-color 0.2s; border: none; }
        .requests-list .view-link:hover { background-color: #0056b3; }

         /* Toast Notification */
        .toast-notification { position: fixed; top: 20px; right: 20px; background-color: #333; color: white; padding: 15px 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 2000; display: flex; align-items: center; gap: 15px; animation: slideIn 0.5s ease forwards; }
        .toast-notification.fade-out { animation: fadeOut 0.5s ease 2.5s forwards; }
        .toast-notification.success { background-color: #28a745; }
        .toast-notification.error { background-color: #dc3545; }
        .toast-notification i { font-size: 1.5rem; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; transform: translateX(100%); } }

        /* --- RESPONSIVIDADE COM MENU HAMBURGUER (Mantendo consistência visual) --- */
        .nav-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5); z-index: 1000; opacity: 0; transition: opacity 0.3s ease;
        }
        .nav-overlay.is-open { display: block; opacity: 1; }

        @media (max-width: 992px) {
             body { display: block; overflow-y: auto;} /* Body volta a rolar */

             .sidebar {
                 left: -250px; /* Começa escondida */
                 z-index: 1100; /* Acima do overlay */
                 height: 100vh; /* Ocupa altura total */
             }
             .sidebar.is-open {
                 left: 0; /* Mostra */
             }
             /* Mantém a sidebar expandida visualmente quando aberta no mobile */
             .sidebar.collapsed { width: 250px; }
             .sidebar.collapsed .logo { padding: 20px 0; border-bottom-color: rgba(255, 255, 255, 0.2); } /* Restaura padding e borda */
             .sidebar.collapsed .logo img { opacity: 1; width: auto; max-width: 150px; } /* Mostra logo */
             .sidebar.collapsed .menu-item, .sidebar.collapsed .menu-item-logout { justify-content: flex-start; padding: 12px 25px; }
             .sidebar.collapsed .menu-item span, .sidebar.collapsed .menu-item-logout span { opacity: 1; width: auto; }
             .sidebar-bottom { display: none; } /* Esconde botão colapsar desktop */

             .content { margin-left: 0; height: auto; min-height: 100vh;}
             .content.shifted { margin-left: 0; }

             .header {
                 width: 100%; left: 0; height: 60px; padding: 0 1rem;
                 position: fixed;
             }
             .header.shifted { width: 100%; left: 0; }
             .header-title { display: none; } /* Esconde "Dashboard" */

             .menu-toggle-mobile { display: block; } /* Mostra Hamburger */

             .main-content { margin-top: 60px; padding: 1rem; }
             .dashboard-grid, .dashboard-row { padding: 0; gap: 1rem; }
             .stat-card { padding: 1rem; gap: 1rem; }
             .stat-card .icon-container { width: 45px; height: 45px; font-size: 1.5rem; padding: 0.6rem;} /* Ícone um pouco menor */
             .stat-card .info p { font-size: 1.6rem; }
             .chart-container, .recent-requests { padding: 1rem; }
        }

    </style>
</head>
<body>
    <div class="sidebar" id="sidebar">
        <div>
            <div class="logo"><a href="index.html"><img src="IMG/ocean coffee.png" alt="Logo Ocean Coffee"></a></div>
            <div class="menu">
                <a href="dashboard.html" class="menu-item selected">
                    <i class="fas fa-tachometer-alt fa-fw"></i>
                    <span>Dashboard</span>
                </a>
                <a href="admin.html" class="menu-item">
                    <i class="fas fa-users fa-fw"></i>
                    <span>Usuários</span>
                </a>
                <a href="Solicitações.html" class="menu-item">
                    <i class="fas fa-inbox fa-fw"></i>
                    <span>Solicitações</span>
                </a>
                <a href="Aprovados.html" class="menu-item">
                    <i class="fas fa-check-circle fa-fw"></i>
                    <span>Aprovados</span>
                </a>
            </div>
        </div>
         <div>
             <a href="#" class="menu-item-logout">
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.09 15.59L11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67l-2.58 2.59zM19 3H5c-1.1 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/></svg>
                 <span>Logout</span>
             </a>
             <div class="sidebar-bottom" id="sidebarToggle">
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 18h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zm0-5h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zm0-5h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1z"/></svg>
             </div>
         </div>
    </div>

    <div class="nav-overlay" id="nav-overlay"></div>

    <div class="content" id="mainContent">
        <div class="header" id="mainHeader">
             <button class="menu-toggle-mobile" id="menu-toggle-mobile" aria-label="Abrir menu">
                 <i class="fas fa-bars"></i>
             </button>
             <span class="header-title">Dashboard</span>
             <div></div>
        </div>

        <div class="main-content">
            <div class="dashboard-grid">
                 <a href="admin.html" class="stat-card-link">
                    <div class="stat-card">
                        <div class="icon-container users"><i class="fas fa-users"></i></div>
                        <div class="info">
                            <h3>Total de Usuários</h3>
                            <p id="total-users">0</p>
                        </div>
                    </div>
                </a>
                <a href="Solicitações.html" class="stat-card-link">
                    <div class="stat-card">
                        <div class="icon-container pending"><i class="fas fa-inbox"></i></div>
                        <div class="info">
                            <h3>Aprovações Pendentes</h3>
                            <p id="pending-requests">0</p>
                        </div>
                    </div>
                </a>
                <a href="Aprovados.html" class="stat-card-link">
                    <div class="stat-card">
                        <div class="icon-container approved"><i class="fas fa-check-circle"></i></div>
                        <div class="info">
                            <h3>Anúncios Aprovados</h3>
                            <p id="approved-ads">0</p>
                        </div>
                    </div>
                </a>
            </div>

            <div class="dashboard-row">
                <div class="chart-container">
                    <h2>Distribuição de Anúncios</h2>
                    <div id="pieChartContainer">
                        <canvas id="statusPieChart"></canvas>
                    </div>
                </div>
                <div class="recent-requests">
                    <h2>Últimas Solicitações</h2>
                    <ul class="requests-list" id="requests-list">
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.44.1/+esm";

        const supabaseUrl = "https://uldxazlnnpuoxfzsovmu.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVsZHhhemxubnB1b3hmenNvdm11Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg3Mjg2NzgsImV4cCI6MjA2NDMwNDY3OH0.fyToys8_muc1XyUebJ19gxGEkCVM_cXg80UJR894xQY";
        const supabase = createClient(supabaseUrl, supabaseKey);

        // Funções showWelcomeToast, fetchDashboardStats, fetchRecentRequests, renderStatusPieChart (sem alterações)
        function showWelcomeToast(name) {
            const toast = document.createElement('div');
            toast.className = 'toast-notification success';
            toast.innerHTML = `<i class="fas fa-check-circle"></i><span>Bem-vindo(a), ${name}!</span>`;
            document.body.appendChild(toast);
            setTimeout(() => { toast.classList.add('fade-out'); toast.addEventListener('animationend', () => toast.remove()); }, 3000);
        }
        async function fetchDashboardStats() {
             const [ { count: usersCount }, { count: pendingCount }, { count: approvedCount } ] = await Promise.all([
                supabase.from('usuarios').select('*', { count: 'exact', head: true }),
                supabase.from('produtos').select('*', { count: 'exact', head: true }).is('aprovado', null),
                supabase.from('aprovados').select('*', { count: 'exact', head: true })
            ]);
            document.getElementById('total-users').textContent = usersCount || 0;
            document.getElementById('pending-requests').textContent = pendingCount || 0;
            document.getElementById('approved-ads').textContent = approvedCount || 0;
        }
        async function fetchRecentRequests() {
            const listElement = document.getElementById('requests-list');
            listElement.innerHTML = '<li>Carregando...</li>';
            const { data, error } = await supabase.from('produtos').select('id, produto, nome_usuario').is('aprovado', null).order('data', { ascending: false }).limit(5);
            if (error || data.length === 0) { listElement.innerHTML = `<li>${error ? 'Erro ao carregar.' : 'Nenhuma solicitação pendente.'}</li>`; return; }
            listElement.innerHTML = '';
            data.forEach(req => { const li = document.createElement('li'); li.innerHTML = `<div class="product-info"><p class="product-name">${req.produto}</p><p class="user-name">por ${req.nome_usuario}</p></div><a href="Solicitações.html" class="view-link">Ver</a>`; listElement.appendChild(li); });
        }
       async function renderStatusPieChart() {
             const [ { count: approvedCount }, { count: pendingCount }, { count: rejectedCount } ] = await Promise.all([
                supabase.from('aprovados').select('*', { count: 'exact', head: true }),
                supabase.from('produtos').select('*', { count: 'exact', head: true }).is('aprovado', null),
                supabase.from('produtos').select('*', { count: 'exact', head: true }).eq('aprovado', false)
            ]);
            // Linha CORRETA:
const ctx = document.getElementById('statusPieChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie', data: { labels: ['Aprovados', 'Pendentes', 'Rejeitados'], datasets: [{ data: [approvedCount || 0, pendingCount || 0, rejectedCount || 0], backgroundColor: ['#28a745', '#ffc107', '#dc3545'], borderColor: '#ffffff', borderWidth: 3, hoverOffset: 4 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { padding: 20 } }, tooltip: { callbacks: { label: ctx => `${ctx.label}: ${ctx.parsed}` } } },
                onClick: (evt, elems) => { if (elems.length > 0) { const label = ['Aprovados', 'Pendentes', 'Rejeitados'][elems[0].index]; if (label === 'Aprovados') window.location.href = 'Aprovados.html'; else if (label === 'Pendentes') window.location.href = 'Solicitações.html'; } } }
            });
        }

        document.addEventListener("DOMContentLoaded", () => {
            const adminName = localStorage.getItem("bemVindo");
            if (adminName) { showWelcomeToast(adminName); localStorage.removeItem("bemVindo"); }

            fetchDashboardStats();
            fetchRecentRequests();
            renderStatusPieChart();

            const sidebar = document.getElementById("sidebar");
            const sidebarToggle = document.getElementById("sidebarToggle"); // Botão Desktop
            const mainContent = document.getElementById("mainContent");
            const mainHeader = document.getElementById("mainHeader");
            const menuToggleMobile = document.getElementById('menu-toggle-mobile'); // Botão Mobile
            const navOverlay = document.getElementById('nav-overlay');

            const applyDesktopCollapsedState = () => {
                 if (window.innerWidth <= 992) return;
                 const isCollapsed = localStorage.getItem("sidebarCollapsed") === "true";
                 sidebar.classList.toggle("collapsed", isCollapsed);
                 mainContent.classList.toggle("shifted", isCollapsed);
                 mainHeader.classList.toggle("shifted", isCollapsed);
            };

            applyDesktopCollapsedState();

            sidebarToggle.addEventListener("click", () => {
                 if (window.innerWidth > 992) {
                    sidebar.classList.toggle("collapsed");
                    mainContent.classList.toggle("shifted");
                    mainHeader.classList.toggle("shifted");
                    localStorage.setItem("sidebarCollapsed", sidebar.classList.contains("collapsed"));
                 }
            });

             const closeMobileMenu = () => { sidebar.classList.remove('is-open'); navOverlay.classList.remove('is-open'); };
             menuToggleMobile.addEventListener('click', () => { sidebar.classList.add('is-open'); navOverlay.classList.add('is-open'); });
             navOverlay.addEventListener('click', closeMobileMenu);
             sidebar.querySelectorAll('.menu-item, .menu-item-logout').forEach(item => {
                 item.addEventListener('click', () => { if (window.innerWidth <= 992 && !item.classList.contains('menu-item-logout')) closeMobileMenu(); });
             });

            document.querySelector(".menu-item-logout").addEventListener("click", async (e) => { e.preventDefault(); await supabase.auth.signOut(); window.location.replace("index.html"); });

             window.addEventListener('resize', () => {
                 if (window.innerWidth > 992) {
                     closeMobileMenu();
                     applyDesktopCollapsedState();
                 } else {
                     // Garante que classes desktop sejam removidas no mobile
                     sidebar.classList.remove("collapsed");
                     mainContent.classList.remove("shifted");
                     mainHeader.classList.remove("shifted");
                 }
             });
        });
    </script>
</body>
</html>